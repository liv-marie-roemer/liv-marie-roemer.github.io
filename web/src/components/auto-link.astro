---
const { text } = Astro.props;

function autoLink(text: string) {
  if (!text) return '';
  
  let result = text;
  
  // Parse markdown links first: [text](url)
  result = result.replace(
    /\[([^\]]+)\]\(([^)]+)\)/g,
    '<a href="$2" target="_blank" rel="noopener">$1</a>'
  );
  
  // For remaining replacements, avoid already linked content by using negative lookahead/lookbehind
  result = result.replace(
    /(?<!href="|">)([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)(?!<\/a>)/gi,
    '<a href="mailto:$1">$1</a>'
  );
  
  result = result.replace(
    /(?<!href="|">)(\+?\d{1,4}[\s-]?\(?\d{1,4}\)?[\s-]?\d{1,4}[\s-]?\d{1,9})(?!<\/a>)/g,
    (match) => {
      const cleanNumber = match.replace(/[\s-]/g, '');
      return `<a href="tel:${cleanNumber}">${match}</a>`;
    }
  );
  
  result = result.replace(
    /(?<!href="|">)((https?:\/\/[^\s<]+)|(www\.[^\s<]+))(?!<\/a>)/gi,
    (match) => {
      const href = match.startsWith('www') ? `https://${match}` : match;
      return `<a href="${href}" target="_blank" rel="noopener">${match}</a>`;
    }
  );
  
  return result;
}

const linkedText = autoLink(text);
---

<span set:html={linkedText} />